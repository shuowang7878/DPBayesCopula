---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%",
  eval = FALSE
)
```

# DPCopula

`DPCopula` provides differentially private copula-based correlation estimation
via two estimators:

- **Bayesian noise-aware (Bayes-NA)**: explicitly accounts for differential 
  privacy noise through a Bayesian model fitted in Stan.
- **MLE noise-naive (MLE-NN)**: treats range-preserving noisy counts as if they 
  were true statistics and estimates correlation matrix via a likelihood-based approach.

## Installation

You can install the development version of DPCopula from [GitHub](https://github.com/) with:

### Option 1: Using `remotes` (recommended for most users)

```{r}
# install.packages("remotes")
remotes::install_github("shuowang7878/DPCopula")
```

### Option 2: Using `pak` (faster dependency resolution)

```{r}
# install.packages("pak")
pak::pak("shuowang7878/DPCopula")
```

Then load the package:

```{r}
library(DPCopula)
```

## Example

### Bayesian noise-aware estimator

```{r Bayes-NA-example}
set.seed(123)
n  <- 200
p  <- 3
X  <- matrix(rnorm(n * p), ncol = p)
colnames(X) <- paste0("X", seq_len(p))

fit_bayes <- bayes_noiseaware(
  data          = X,
  epsilon       = 1,
  iter_sampling = 200,
  iter_warmup   = 200,
  chains        = 2,
  cores         = 2
)

fit_bayes$mean      # DP correlation matrix (posterior mean)
fit_bayes$ci_lower  # 2.5% pairwise credible intervals
fit_bayes$ci_upper  # 97.5% pairwise credible intervals
```

### MLE noise-naive estimator

```{r MLE-NN-example}
set.seed(123)
n  <- 200
p  <- 3
X  <- matrix(rnorm(n * p), ncol = p)
colnames(X) <- paste0("X", seq_len(p))

fit_mle <- mle_noise_naive(
  data    = X,
  epsilon = 1,
  method  = "RTG"
)

fit_mle$estimation   # DP correlation matrix
```

### Range-preserving mechanisms

```{r mechanisms-example}
counts <- c(10, 15, 20)
noisy  <- range_preserving_mechanism(
  counts      = counts,
  n           = 50,
  total_epsilon = 1,
  sensitivity = 1,
  method      = "BTGM",
  round_output = TRUE
)
noisy
```

